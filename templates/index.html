<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Oil Spill Detection | OceanGuard</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0&family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,100..900&family=Montserrat:wght@300;400;500;600;700&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Montserrat", sans-serif;
    }
    
    /* General Styles */
    body {
      margin: 0;
      font-family: "Inter", sans-serif;
      color: #fff;
      background: linear-gradient(135deg, #001220, #003355);
      overflow-x: hidden;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .motion-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(ellipse at top, rgba(0, 61, 89, 0.5), rgba(0, 23, 43, 0.7), rgba(0, 0, 0, 0.9));
      animation: motion 15s ease-in-out infinite alternate;
      z-index: -1;
    }

    @keyframes motion {
      0% {
        background-position: 0% 0%;
      }
      50% {
        background-position: 50% 50%;
      }
      100% {
        background-position: 100% 100%;
      }
    }

    /* Improved Navbar */
    .top-nav {
      position: fixed;
      top: 0;
      width: 100%;
      padding: 15px 0;
      background: rgba(0, 23, 43, 0.8);
      backdrop-filter: blur(10px);
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }

    .top-nav.scrolled {
      padding: 8px 0;
    }

    .nav-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .logo {
      font-size: 24px;
      font-weight: 700;
      color: #fff;
      text-decoration: none;
      display: flex;
      align-items: center;
    }

    .logo i {
      color: #13b2d1;
      margin-right: 10px;
      font-size: 28px;
    }

    .top-nav ul {
      list-style: none;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      margin: 0;
      padding: 0;
    }

    .top-nav li {
      margin: 0 5px;
    }

    .nav-link {
      display: inline-block;
      padding: 10px 15px;
      font-size: 16px;
      font-weight: 600;
      color: white;
      text-decoration: none;
      position: relative;
      transition: all 0.3s ease-in-out;
      border-radius: 6px;
    }

    .nav-link::after {
      content: '';
      position: absolute;
      width: 0;
      height: 3px;
      display: block;
      margin-top: 5px;
      right: 0;
      background: #13b2d1;
      transition: width 0.3s ease, left 0.3s ease;
    }

    .nav-link:hover {
      background: rgba(19, 178, 209, 0.1);
    }

    .nav-link:hover::after {
      width: 100%;
      right: 0;
    }

    .nav-link.active {
      color: #13b2d1;
    }

    .nav-link.active::after {
      width: 100%;
    }

    .user-actions {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .profile-button {
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 50px;
      padding: 5px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .profile-button:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    .profile-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #4facfe;
    }

    /* Hero Section */
    .hero-section {
      text-align: center;
      padding: 180px 20px 120px;
      background: radial-gradient(circle at center, rgba(79, 172, 254, 0.1), transparent 60%);
    }

    .hero-title {
      font-size: 56px;
      font-weight: 800;
      margin-bottom: 25px;
      background: linear-gradient(90deg, #ffffff, #4facfe);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      animation: fadeIn 1.2s ease-in;
    }

    .hero-description {
      font-size: 20px;
      line-height: 1.7;
      max-width: 800px;
      margin: 0 auto 50px;
      color: rgba(255, 255, 255, 0.85);
      animation: fadeIn 1.8s ease-in;
    }

    .hero-button {
      font-size: 18px;
      font-weight: 600;
      padding: 15px 35px;
      background: linear-gradient(90deg, #4facfe, #00f2fe);
      color: #fff;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3);
      animation: fadeIn 2.2s ease-in;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .hero-button:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 25px rgba(79, 172, 254, 0.4);
    }

    /* Side Panel */
    .side-panel {
      position: fixed;
      top: 0;
      left: -350px;
      width: 350px;
      height: 100%;
      background: rgba(0, 23, 43, 0.95);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 4px 0 20px rgba(0, 0, 0, 0.25);
      transition: left 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      overflow-y: auto;
      z-index: 1001;
      border-right: 1px solid rgba(79, 172, 254, 0.3);
    }

    .side-panel.open {
      left: 0;
    }

    .panel-header {
      padding: 25px 20px;
      background: linear-gradient(90deg, #001220, #002b44);
      color: #fff;
      text-align: center;
      font-weight: 600;
      font-size: 1.4rem;
      position: sticky;
      top: 0;
      z-index: 1002;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      border-bottom: 1px solid rgba(79, 172, 254, 0.3);
    }

    .panel-content {
      padding: 20px;
    }

    .profile-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      padding: 20px 0;
    }

    .profile-avatar-large {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #4facfe;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .profile-info {
      background: rgba(255, 255, 255, 0.05);
      color: white;
      padding: 15px;
      border-radius: 10px;
      width: 100%;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(79, 172, 254, 0.2);
    }

    .profile-info p {
      margin: 10px 0;
      font-size: 14px;
    }

    .change-password-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
      width: 100%;
    }

    .change-password-form input {
      padding: 12px 15px;
      width: 100%;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(79, 172, 254, 0.3);
      border-radius: 8px;
      font-size: 14px;
      color: white;
      transition: all 0.3s ease;
    }

    .change-password-form input:focus {
      border-color: #4facfe;
      box-shadow: 0 0 0 2px rgba(79, 172, 254, 0.2);
      outline: none;
    }

    .change-password-form input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    .form-button {
      padding: 12px 20px;
      background: linear-gradient(90deg, #4facfe, #00f2fe);
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .form-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(79, 172, 254, 0.3);
    }

    .logout-button {
      background: linear-gradient(90deg, #ff4b4b, #ff8080);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 20px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      width: 100%;
      margin-top: 20px;
      box-shadow: 0 5px 15px rgba(255, 75, 75, 0.2);
    }

    .logout-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 75, 75, 0.3);
    }

    .toggle-button {
      position: fixed;
      top: 100px;
      left: 20px;
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #4facfe, #00f2fe);
      color: #fff;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 5px 15px rgba(79, 172, 254, 0.3);
      transition: all 0.3s ease;
      font-size: 24px;
      z-index: 999;
    }

    .toggle-button:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 20px rgba(79, 172, 254, 0.4);
    }

    .close-button {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 30px;
      height: 30px;
      background: rgba(255, 75, 75, 0.8);
      color: #fff;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      font-size: 16px;
      z-index: 1003;
    }

    .close-button:hover {
      transform: scale(1.1);
      background: #ff4b4b;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .navbar-container {
        padding: 10px 15px;
      }
      
      .logo-text {
        font-size: 20px;
      }
      
      .nav-menu {
        display: none;
      }

      .hero-title {
        font-size: 38px;
      }

      .hero-description {
        font-size: 16px;
      }
      
      .side-panel {
        width: 280px;
      }
      
      .toggle-button {
        top: 80px;
      }
    }
    #chatbot-toggler {
  position: fixed;
  bottom: 30px;
  right: 35px;
  border: none;
  height: 50px;
  width: 50px;
  display: flex;
  cursor: pointer;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  background: #5350C4;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
  transition: all 0.2s ease;
}

body.show-chatbot #chatbot-toggler {
  transform: rotate(90deg);
}

#chatbot-toggler span {
  color: #fff;
  position: absolute;
}

#chatbot-toggler span:last-child,
body.show-chatbot #chatbot-toggler span:first-child {
  opacity: 0;
}

body.show-chatbot #chatbot-toggler span:last-child {
  opacity: 1;
}

.chatbot-popup {
  position: fixed;
  right: 35px;
  bottom: 90px;
  width: 420px;
  overflow: hidden;
  background: #fff;
  border-radius: 15px;
  opacity: 0;
  pointer-events: none;
  transform: scale(0.2);
  transform-origin: bottom right;
  box-shadow: 0 0 128px 0 rgba(0, 0, 0, 0.1),
    0 32px 64px -48px rgba(0, 0, 0, 0.5);
  transition: all 0.1s ease;
}

body.show-chatbot .chatbot-popup {
  opacity: 1;
  pointer-events: auto;
  transform: scale(1);
}

.chat-header {
  display: flex;
  align-items: center;
  padding: 15px 22px;
  background: #5350C4;
  justify-content: space-between;
}

.chat-header .header-info {
  display: flex;
  gap: 10px;
  align-items: center;
}

.header-info .chatbot-logo {
  width: 35px;
  height: 35px;
  padding: 6px;
  fill: #5350C4;
  flex-shrink: 0;
  background: #fff;
  border-radius: 50%;
}

.header-info .logo-text {
  color: #fff;
  font-weight: 600;
  font-size: 1.31rem;
  letter-spacing: 0.02rem;
}

.chat-header #close-chatbot {
  border: none;
  color: #fff;
  height: 40px;
  width: 40px;
  font-size: 1.9rem;
  margin-right: -10px;
  padding-top: 2px;
  cursor: pointer;
  border-radius: 50%;
  background: none;
  transition: 0.2s ease;
}

.chat-header #close-chatbot:hover {
  background: #3d39ac;
}

.chat-body {
  padding: 25px 22px;
  gap: 20px;
  display: flex;
  height: 250px;
  overflow-y: auto;
  margin-bottom: 82px;
  flex-direction: column;
  scrollbar-width: thin;
  scrollbar-color: #ccccf5 transparent;
}

.chat-body,
.chat-form .message-input:hover {
  scrollbar-color: #ccccf5 transparent;
}

.chat-body .message {
  display: flex;
  gap: 11px;
  align-items: center;
}

.chat-body .message .bot-avatar {
  width: 35px;
  height: 35px;
  padding: 6px;
  fill: #fff;
  flex-shrink: 0;
  margin-bottom: 2px;
  align-self: flex-end;
  border-radius: 50%;
  background: #5350C4;
}

.chat-body .message .message-text {
  padding: 12px 16px;
  max-width: 75%;
  color:black;
  font-size: 0.95rem;
}

.chat-body .bot-message.thinking .message-text {
  padding: 2px 16px;
}

.chat-body .bot-message .message-text {
  background: #F2F2FF;
  border-radius: 13px 13px 13px 3px;
}

.chat-body .user-message {
  flex-direction: column;
  align-items: flex-end;
}

.chat-body .user-message .message-text {
  color: #fff;
  background: #5350C4;
  border-radius: 13px 13px 3px 13px;
}

.chat-body .user-message .attachment {
  width: 50%;
  margin-top: -7px;
  border-radius: 13px 3px 13px 13px;
}

.chat-body .bot-message .thinking-indicator {
  display: flex;
  gap: 4px;
  padding-block: 15px;
}

.chat-body .bot-message .thinking-indicator .dot {
  height: 7px;
  width: 7px;
  opacity: 0.7;
  border-radius: 50%;
  background: #6F6BC2;
  animation: dotPulse 1.8s ease-in-out infinite;
}

.chat-body .bot-message .thinking-indicator .dot:nth-child(1) {
  animation-delay: 0.2s;
}

.chat-body .bot-message .thinking-indicator .dot:nth-child(2) {
  animation-delay: 0.3s;
}

.chat-body .bot-message .thinking-indicator .dot:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes dotPulse {

  0%,
  44% {
    transform: translateY(0);
  }

  28% {
    opacity: 0.4;
    transform: translateY(-4px);
  }

  44% {
    opacity: 0.2;
  }
}

.chat-footer {
  position: absolute;
  bottom: 0;
  width: 100%;
  background: #fff;
  padding: 15px 22px 20px;
}

.chat-footer .chat-form {
  display: flex;
  align-items: center;
  position: relative;
  background: #fff;
  border-radius: 32px;
  outline: 1px solid #CCCCE5;
  box-shadow: 0 0 8px rgba(0, 0, 0, 0.06);
  transition: 0s ease, border-radius 0s;
}

.chat-form:focus-within {
  outline: 2px solid #5350C4;
}

.chat-form .message-input {
  width: 100%;
  height: 47px;
  outline: none;
  resize: none;
  border: none;
  max-height: 180px;
  scrollbar-width: thin;
  border-radius: inherit;
  font-size: 0.95rem;
  padding: 14px 0 12px 18px;
  scrollbar-color: transparent transparent;
}

.chat-form .chat-controls {
  gap: 3px;
  height: 47px;
  display: flex;
  padding-right: 6px;
  align-items: center;
  align-self: flex-end;
}

.chat-form .chat-controls button {
  height: 35px;
  width: 35px;
  border: none;
  cursor: pointer;
  color: #706DB0;
  border-radius: 50%;
  font-size: 1.15rem;
  background: none;
  transition: 0.2s ease;
}

.chat-form .chat-controls button:hover,
body.show-emoji-picker .chat-controls #emoji-picker {
  color: #3d39ac;
  background: #f1f1ff;
}

.chat-form .chat-controls #send-message {
  color: #fff;
  display: none;
  background: #5350C4;
}

.chat-form .chat-controls #send-message:hover {
  background: #3d39ac;
}

.chat-form .message-input:valid~.chat-controls #send-message {
  display: block;
}

.chat-form .file-upload-wrapper {
  position: relative;
  height: 35px;
  width: 35px;
}

.chat-form .file-upload-wrapper :where(button, img) {
  position: absolute;
}

.chat-form .file-upload-wrapper img {
  height: 100%;
  width: 100%;
  object-fit: cover;
  border-radius: 50%;
}

.chat-form .file-upload-wrapper #file-cancel {
  color: #ff0000;
  background: #fff;
}

.chat-form .file-upload-wrapper :where(img, #file-cancel),
.chat-form .file-upload-wrapper.file-uploaded #file-upload {
  display: none;
}

.chat-form .file-upload-wrapper.file-uploaded img,
.chat-form .file-upload-wrapper.file-uploaded:hover #file-cancel {
  display: block;
}

em-emoji-picker {
  position: absolute;
  left: 50%;
  top: -337px;
  width: 100%;
  max-width: 350px;
  visibility: hidden;
  max-height: 330px;
  transform: translateX(-50%);
}

body.show-emoji-picker em-emoji-picker {
  visibility: visible;
}

/* Responsive media query for mobile screens */
@media (max-width: 520px) {
  #chatbot-toggler {
    right: 20px;
    bottom: 20px;
  }

  .chatbot-popup {
    right: 0;
    bottom: 0;
    height: 100%;
    border-radius: 0;
    width: 100%;
  }

  .chatbot-popup .chat-header {
    padding: 12px 15px;
  }

  .chat-body {
    height: calc(90% - 55px);
    padding: 25px 15px;
  }

  .chat-footer {
    padding: 10px 15px 15px;
  }

  .chat-form .file-upload-wrapper.file-uploaded #file-cancel {
    opacity: 0;
  }
}
  </style>
</head>
<body>
  <!-- Motion Background -->
  <div class="motion-bg"></div>

  <nav class="top-nav" id="topNav">
    <div class="nav-container">
      <a href="index.html" class="logo">
        <i class="fas fa-water"></i>
        <span>OilSpillAI</span>
      </a>
      <ul id="navMenu">
        <li><a href="index.html" class="nav-link active">Home</a></li>
        <li><a href="about.html" class="nav-link">About Us</a></li>
        <li><a href="problem.html" class="nav-link">Problem</a></li>
        <li><a href="hardware_map.html" class="nav-link">Hardware Map</a></li>
        <li><a href="base.html" class="nav-link">Social Media</a></li>
      </ul>
    </div>
  </nav>

  <!-- Toggle button for side panel -->
  <button class="toggle-button" onclick="toggleSidePanel()">
    ☰
  </button>
  
  <!-- Side panel -->
  <div class="side-panel" id="sidePanel">
    <div class="panel-header">
      User Profile
      <button class="close-button" onclick="closeSidePanel()">✕</button>
    </div>
    
    <div class="panel-content">
      <div class="profile-container">
        <img src="{% if user.avatar %}/{{ user.avatar }}{% else %}/static/avatars/default_oil_social.png{% endif %}" class="profile-avatar-large" alt="User Avatar">
        
        <div class="profile-info">
          <p>Email: <span id="profile-email">{{ user[0] }}</span></p>
          <p>Username: <span id="profile-username">{{ user[1] }}</span></p>
        </div>
        
        <form class="change-password-form" id="changePasswordForm">
          <input type="password" id="newPassword" placeholder="New Password" required>
          <button type="button" class="form-button" onclick="changePassword()">Change Password</button>
          <button type="button" class="form-button" onclick="changeProfilePicture()">Change Profile Picture</button>
        </form>
        
        <form action="/logout" method="POST">
          <button type="submit" class="logout-button">Logout</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Hero Section -->
  <div class="hero-section">
    <div class="container">
      <h1 class="hero-title">Oil Spill Detection</h1>
      <p class="hero-description">
        Our advanced platform uses AI technology to detect oil spills and predict their movement patterns. Join our mission to prevent environmental disasters, protect marine life, and preserve vital ecosystems for future generations.
      </p>
      <button class="hero-button" onclick="location.href='formpage.html'">Get Started</button>
    </div>
  </div>
<!-- Chatbot Toggler -->
<button id="chatbot-toggler">
  <span class="material-symbols-rounded">mode_comment</span>
  <span class="material-symbols-rounded">close</span>
</button>

<div class="chatbot-popup">
  <!-- Chatbot Header -->
  <div class="chat-header">
    <div class="header-info">
      <svg class="chatbot-logo" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 1024 1024">
        <path
          d="M738.3 287.6H285.7c-59 0-106.8 47.8-106.8 106.8v303.1c0 59 47.8 106.8 106.8 106.8h81.5v111.1c0 .7.8 1.1 1.4.7l166.9-110.6 41.8-.8h117.4l43.6-.4c59 0 106.8-47.8 106.8-106.8V394.5c0-59-47.8-106.9-106.8-106.9zM351.7 448.2c0-29.5 23.9-53.5 53.5-53.5s53.5 23.9 53.5 53.5-23.9 53.5-53.5 53.5-53.5-23.9-53.5-53.5zm157.9 267.1c-67.8 0-123.8-47.5-132.3-109h264.6c-8.6 61.5-64.5 109-132.3 109zm110-213.7c-29.5 0-53.5-23.9-53.5-53.5s23.9-53.5 53.5-53.5 53.5 23.9 53.5 53.5-23.9 53.5-53.5 53.5zM867.2 644.5V453.1h26.5c19.4 0 35.1 15.7 35.1 35.1v121.1c0 19.4-15.7 35.1-35.1 35.1h-26.5zM95.2 609.4V488.2c0-19.4 15.7-35.1 35.1-35.1h26.5v191.3h-26.5c-19.4 0-35.1-15.7-35.1-35.1zM561.5 149.6c0 23.4-15.6 43.3-36.9 49.7v44.9h-30v-44.9c-21.4-6.5-36.9-26.3-36.9-49.7 0-28.6 23.3-51.9 51.9-51.9s51.9 23.3 51.9 51.9z"
        />
      </svg>
      <h2 class="logo-text">Chatbot</h2>
    </div>
    <button id="close-chatbot" class="material-symbols-rounded">keyboard_arrow_down</button>
  </div>

  <!-- Chatbot Body -->
  <div class="chat-body">
    <div class="message bot-message">
      <svg class="bot-avatar" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 1024 1024">
        <path
          d="M738.3 287.6H285.7c-59 0-106.8 47.8-106.8 106.8v303.1c0 59 47.8 106.8 106.8 106.8h81.5v111.1c0 .7.8 1.1 1.4.7l166.9-110.6 41.8-.8h117.4l43.6-.4c59 0 106.8-47.8 106.8-106.8V394.5c0-59-47.8-106.9-106.8-106.9zM351.7 448.2c0-29.5 23.9-53.5 53.5-53.5s53.5 23.9 53.5 53.5-23.9 53.5-53.5 53.5-53.5-23.9-53.5-53.5zm157.9 267.1c-67.8 0-123.8-47.5-132.3-109h264.6c-8.6 61.5-64.5 109-132.3 109zm110-213.7c-29.5 0-53.5-23.9-53.5-53.5s23.9-53.5 53.5-53.5 53.5 23.9 53.5 53.5-23.9 53.5-53.5 53.5zM867.2 644.5V453.1h26.5c19.4 0 35.1 15.7 35.1 35.1v121.1c0 19.4-15.7 35.1-35.1 35.1h-26.5zM95.2 609.4V488.2c0-19.4 15.7-35.1 35.1-35.1h26.5v191.3h-26.5c-19.4 0-35.1-15.7-35.1-35.1zM561.5 149.6c0 23.4-15.6 43.3-36.9 49.7v44.9h-30v-44.9c-21.4-6.5-36.9-26.3-36.9-49.7 0-28.6 23.3-51.9 51.9-51.9s51.9 23.3 51.9 51.9z"
        />
      </svg>
      <!-- prettier-ignore -->
      <div class="message-text"> Hey there  <br /> How can I help you today? </div>
    </div>
  </div>

  <!-- Chatbot Footer -->
  <div class="chat-footer">
    <form action="#" class="chat-form">
      <textarea placeholder="Message..." class="message-input" required></textarea>
      <div class="chat-controls">
        <button type="button" id="emoji-picker" class="material-symbols-outlined">sentiment_satisfied</button>
        <div class="file-upload-wrapper">
          <input type="file" accept="image/*" id="file-input" hidden />
          <img src="#" />
          <button type="button" id="file-upload" class="material-symbols-rounded">attach_file</button>
          <button type="button" id="file-cancel" class="material-symbols-rounded">close</button>
        </div>
        <button type="submit" id="send-message" class="material-symbols-rounded">arrow_upward</button>
      </div>
    </form>
  </div>
</div>

<!-- Linking Emoji Mart script for emoji picker -->
<script src="https://cdn.jsdelivr.net/npm/emoji-mart@latest/dist/browser.js"></script>

  <script>
    // Set active nav link
    document.addEventListener('DOMContentLoaded', function() {
      const currentPage = window.location.pathname.split('/').pop();
      const navLinks = document.querySelectorAll('.nav-link');
      
      navLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === currentPage) {
          link.classList.add('active');
        }
      });
      
      // Default to home if we're on index.html or root
      if (currentPage === '' || currentPage === 'index.html') {
        document.getElementById('home-link').classList.add('active');
      }
    });
    
    // Toggle side panel
    function toggleSidePanel() {
      document.getElementById('sidePanel').classList.toggle('open');
    }
    
    // Close side panel
    function closeSidePanel() {
      document.getElementById('sidePanel').classList.remove('open');
    }
    
    // Change password function
    function changePassword() {
      const newPassword = document.getElementById('newPassword').value;
      if (!newPassword) {
        alert('Please enter a new password');
        return;
      }
      
      const formData = new FormData();
      formData.append('new_password', newPassword);
      
      fetch('/change_password', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('Password changed successfully!');
          document.getElementById('newPassword').value = '';
        } else {
          alert('Failed to change password: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Error changing password:', error);
        alert('An error occurred while changing the password');
      });
    }
    
    // Change profile picture function
    function changeProfilePicture() {
      // Ideally this would open a file picker, but for now using prompt
      const newPicture = prompt("Enter the URL of the new profile picture:");
      if (newPicture) {
        // Update all avatar instances
        const avatars = document.querySelectorAll('.profile-avatar, .profile-avatar-large');
        avatars.forEach(avatar => {
          avatar.src = newPicture;
        });
        
        // Store in local storage for persistence
        localStorage.setItem('profilePicture', newPicture);
        alert("Profile picture updated successfully!");
      }
    }
    
    // Load saved profile picture if available
    document.addEventListener('DOMContentLoaded', function() {
      const savedAvatar = localStorage.getItem('profilePicture');
      if (savedAvatar) {
        const avatars = document.querySelectorAll('.profile-avatar, .profile-avatar-large');
        avatars.forEach(avatar => {
          avatar.src = savedAvatar;
        });
      }
    });
      const chatBody = document.querySelector(".chat-body");
  const messageInput = document.querySelector(".message-input");
  const sendMessage = document.querySelector("#send-message");
  const fileInput = document.querySelector("#file-input");
  const fileUploadWrapper = document.querySelector(".file-upload-wrapper");
  const fileCancelButton = fileUploadWrapper.querySelector("#file-cancel");
  const chatbotToggler = document.querySelector("#chatbot-toggler");
  const closeChatbot = document.querySelector("#close-chatbot");

  // API setup
  const API_KEY = "AIzaSyBXzthKOPQNyR-IT5kJEBx8thSpDUWOv3s";
  const API_URL = `https://generativelanguage.googleapis.com/v1/models/gemini-1.5-pro:generateContent?key=${API_KEY}`;

  // Initialize user message and file data
  const userData = {
  message: null,
  file: {
  data: null,
  mime_type: null,
  },
  };

  // Store chat history
  const chatHistory = [];
  const initialInputHeight = messageInput.scrollHeight;

  // Create message element with dynamic classes and return it
  const createMessageElement = (content, ...classes) => {
  const div = document.createElement("div");
  div.classList.add("message", ...classes);
  div.innerHTML = content;
  return div;
  };

  // Generate bot response using API
  const generateBotResponse = async (incomingMessageDiv) => {
  const messageElement = incomingMessageDiv.querySelector(".message-text");

  // Add user message to chat history
  chatHistory.push({
  role: "user",
  parts: [{ text: userData.message }, ...(userData.file.data ? [{ inline_data: userData.file }] : [])],
  });

  // API request options
  const requestOptions = {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    contents: chatHistory,
  }),
  };

  try {
  // Fetch bot response from API
  const response = await fetch(API_URL, requestOptions);
  const data = await response.json();
  if (!response.ok) throw new Error(data.error.message);

  // Extract and display bot's response text
  const apiResponseText = data.candidates[0].content.parts[0].text.replace(/\*\*(.*?)\*\*/g, "$1").trim();
  messageElement.innerText = apiResponseText;

  // Add bot response to chat history
  chatHistory.push({
    role: "model",
    parts: [{ text: apiResponseText }],
  });
  } catch (error) {
  // Handle error in API response
  console.log(error);
  messageElement.innerText = error.message;
  messageElement.style.color = "#ff0000";
  } finally {
  // Reset user's file data, removing thinking indicator and scroll chat to bottom
  userData.file = {};
  incomingMessageDiv.classList.remove("thinking");
  chatBody.scrollTo({ top: chatBody.scrollHeight, behavior: "smooth" });
  }
  };

  // Handle outgoing user messages
  const handleOutgoingMessage = (e) => {
  e.preventDefault();
  userData.message = messageInput.value.trim();
  messageInput.value = "";
  messageInput.dispatchEvent(new Event("input"));
  fileUploadWrapper.classList.remove("file-uploaded");

  // Create and display user message
  const messageContent = `<div class="message-text"></div>
                        ${userData.file.data ? `<img src="data:${userData.file.mime_type};base64,${userData.file.data}" class="attachment" />` : ""}`;

  const outgoingMessageDiv = createMessageElement(messageContent, "user-message");
  outgoingMessageDiv.querySelector(".message-text").innerText = userData.message;
  chatBody.appendChild(outgoingMessageDiv);
  chatBody.scrollTo({ top: chatBody.scrollHeight, behavior: "smooth" });

  // Simulate bot response with thinking indicator after a delay
  setTimeout(() => {
  const messageContent = `<svg class="bot-avatar" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 1024 1024">
          <path
            d="M738.3 287.6H285.7c-59 0-106.8 47.8-106.8 106.8v303.1c0 59 47.8 106.8 106.8 106.8h81.5v111.1c0 .7.8 1.1 1.4.7l166.9-110.6 41.8-.8h117.4l43.6-.4c59 0 106.8-47.8 106.8-106.8V394.5c0-59-47.8-106.9-106.8-106.9zM351.7 448.2c0-29.5 23.9-53.5 53.5-53.5s53.5 23.9 53.5 53.5-23.9 53.5-53.5 53.5-53.5-23.9-53.5-53.5zm157.9 267.1c-67.8 0-123.8-47.5-132.3-109h264.6c-8.6 61.5-64.5 109-132.3 109zm110-213.7c-29.5 0-53.5-23.9-53.5-53.5s23.9-53.5 53.5-53.5 53.5 23.9 53.5 53.5-23.9 53.5-53.5 53.5zM867.2 644.5V453.1h26.5c19.4 0 35.1 15.7 35.1 35.1v121.1c0 19.4-15.7 35.1-35.1 35.1h-26.5zM95.2 609.4V488.2c0-19.4 15.7-35.1 35.1-35.1h26.5v191.3h-26.5c-19.4 0-35.1-15.7-35.1-35.1zM561.5 149.6c0 23.4-15.6 43.3-36.9 49.7v44.9h-30v-44.9c-21.4-6.5-36.9-26.3-36.9-49.7 0-28.6 23.3-51.9 51.9-51.9s51.9 23.3 51.9 51.9z"/></svg>
        <div class="message-text">
          <div class="thinking-indicator">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
          </div>
        </div>`;

  const incomingMessageDiv = createMessageElement(messageContent, "bot-message", "thinking");
  chatBody.appendChild(incomingMessageDiv);
  chatBody.scrollTo({ top: chatBody.scrollHeight, behavior: "smooth" });
  generateBotResponse(incomingMessageDiv);
  }, 600);
  };

  // Adjust input field height dynamically
  messageInput.addEventListener("input", () => {
  messageInput.style.height = `${initialInputHeight}px`;
  messageInput.style.height = `${messageInput.scrollHeight}px`;
  document.querySelector(".chat-form").style.borderRadius = messageInput.scrollHeight > initialInputHeight ? "15px" : "32px";
  });

  // Handle Enter key press for sending messages
  messageInput.addEventListener("keydown", (e) => {
  const userMessage = e.target.value.trim();
  if (e.key === "Enter" && !e.shiftKey && userMessage && window.innerWidth > 768) {
  handleOutgoingMessage(e);
  }
  });

  // Handle file input change and preview the selected file
  fileInput.addEventListener("change", () => {
  const file = fileInput.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = (e) => {
  fileInput.value = "";
  fileUploadWrapper.querySelector("img").src = e.target.result;
  fileUploadWrapper.classList.add("file-uploaded");
  const base64String = e.target.result.split(",")[1];

  // Store file data in userData
  userData.file = {
    data: base64String,
    mime_type: file.type,
  };
  };

  reader.readAsDataURL(file);
  });

  // Cancel file upload
  fileCancelButton.addEventListener("click", () => {
  userData.file = {};
  fileUploadWrapper.classList.remove("file-uploaded");
  });

  // Initialize emoji picker and handle emoji selection
  const picker = new EmojiMart.Picker({
  theme: "light",
  skinTonePosition: "none",
  previewPosition: "none",
  onEmojiSelect: (emoji) => {
  const { selectionStart: start, selectionEnd: end } = messageInput;
  messageInput.setRangeText(emoji.native, start, end, "end");
  messageInput.focus();
  },
  onClickOutside: (e) => {
  if (e.target.id === "emoji-picker") {
    document.body.classList.toggle("show-emoji-picker");
  } else {
    document.body.classList.remove("show-emoji-picker");
  }
  },
  });

  document.querySelector(".chat-form").appendChild(picker);

  sendMessage.addEventListener("click", (e) => handleOutgoingMessage(e));
  document.querySelector("#file-upload").addEventListener("click", () => fileInput.click());
  closeChatbot.addEventListener("click", () => document.body.classList.remove("show-chatbot"));
  chatbotToggler.addEventListener("click", () => document.body.classList.toggle("show-chatbot"));
  </script>
</body>
</html>